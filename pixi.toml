[project]
name = "halloween2"
version = "2.0.0"
description = "Halloween 2.0 - Modern C++ Animatronics"
channels = ["conda-forge"]
platforms = ["linux-64"]

[dependencies]
cmake = ">=3.14"
gtest = ">=1.14"
gcovr = ">=7.0"
compilers = "*"
python = ">=3.8"
requests = ">=2.25"
clang-format = ">=17.0"

[tasks]
# Phase 0: All examples (blink_led)
# Phase 0.1 (trivial_math) validated and removed - superseded by blink_led
test-all = "cmake -S. -B build/test -DBUILD_TESTS=ON && cmake --build build/test && ctest --test-dir build/test --output-on-failure"
coverage-all = "cmake -S. -B build/coverage -DBUILD_TESTS=ON -DENABLE_COVERAGE=ON && cmake --build build/coverage && cd build/coverage && ctest && cd ../.. && mkdir -p coverage-html && gcovr -r . --gcov-ignore-errors=no_working_dir_found --sonarqube coverage.xml --html-details coverage-html/index.html --print-summary --exclude build --exclude '.*test.*' --exclude '.*main.cpp'"
view-coverage-all = "xdg-open coverage-html/index.html"

# Phase 0.2: blink_led only
test-blink = "cmake -S. -B build/test -DBUILD_TESTS=ON && cmake --build build/test && ctest --test-dir build/test --output-on-failure -R BlinkController"
coverage-blink = "cmake -S. -B build/coverage -DBUILD_TESTS=ON -DENABLE_COVERAGE=ON && cmake --build build/coverage && cd build/coverage && ctest -R BlinkController && cd ../.. && mkdir -p coverage-html && gcovr -r . --gcov-ignore-errors=no_working_dir_found --sonarqube coverage.xml --html-details coverage-html/index.html --print-summary --exclude build --exclude '.*test.*' --exclude '.*main.cpp'"
view-coverage-blink = "xdg-open coverage-html/index.html"
demo-blink = "cmake -S. -B build/demo -DENABLE_COVERAGE=ON && cmake --build build/demo && ./build/demo/projects/examples/blink_led/blink_demo"

# Convenience aliases (default to all)
test = { depends-on = ["test-all"] }
coverage = { depends-on = ["coverage-all"] }
view-coverage = { depends-on = ["view-coverage-all"] }

# Cleanup
clean = "rm -rf build coverage-html coverage.xml"

# Code formatting
format-check = "find lib projects -name '*.cpp' -o -name '*.h' | xargs clang-format --dry-run --Werror"
format-fix = "find lib projects -name '*.cpp' -o -name '*.h' | xargs clang-format -i"

# Status checks (requires requests package and gh CLI)
check-ci = "python tools/ci_check.py"
check-sonarcloud = "python tools/sonarcloud_check.py --project griswaldbrooks_sonarcloud-cpp-minimal"
status-check = "python tools/status.py"
